
using FastGaussQuadrature
using Polynomials


function getCoefficientsGLRK1(T=Float64)
    a = reshape(Array{T}([0.5]), (1,1))
    b = Vector{T}([1.0])
    c = Vector{T}([0.5])
    o = 2

    CoefficientsRK(:glrk1, o, a, b, c)
end

function getCoefficientsGLRK2(T=Float64)
    a = Array{T}([
          [1/4       1/4-√3/6]
          [1/4+√3/6  1/4     ]
        ])
    b = Vector{T}([1/2,      1/2     ])
    c = Vector{T}([1/2-√3/6, 1/2+√3/6])
    o = 4

    CoefficientsRK(:glrk2, o, a, b, c)
end

function getCoefficientsGLRK3(T=Float64)
    a = Array{T}([
          [5/36         2/9-√15/15  5/36-√15/30]
          [5/36+√15/24  2/9         5/36-√15/24]
          [5/36+√15/30  2/9+√15/15  5/36       ]
        ])
    b = Vector{T}([5/18,        4/9,        5/18       ])
    c = Vector{T}([1/2-√15/10,  1/2,        1/2+√15/10 ])
    o = 6

    CoefficientsRK(:glrk3, o, a, b, c)
end

function getCoefficientsGLRK4(T=Float64)
    a = reshape(Array{T}([
         [(-√30/144 + 1/8)
          (-13*√42/336 - √10/16 - √3/12 + √(-60*√30 + 450)/144 + √35/28 + √(-2*√30 + 15)/8)/√(-2*√30 + 15)
          (-√35/28 - √10/16 - √3/12 + √(-60*√30 + 450)/144 + 13*√42/336 + √(-2*√30 + 15)/8)/√(-2*√30 + 15)
          (-√35/14 - √(60*√30 + 450)/144 - √42/168 + √(2*√30 + 15)/8)/√(2*√30 + 15)];
         [(-√(60*√30 + 450)/144 - √3/12 + √10/16 + √35/28 + 13*√42/336 + √(2*√30 + 15)/8)/√(2*√30 + 15)
          (√30/144 + 1/8)
          (-√35/14 + √42/168 + √(-60*√30 + 450)/144 + √(-2*√30 + 15)/8)/√(-2*√30 + 15)
          (-13*√42/336 - √35/28 - √(60*√30 + 450)/144 - √3/12 + √10/16 + √(2*√30 + 15)/8)/√(2*√30 + 15)];
         [(-√10/16 - √(60*√30 + 450)/144 + √3/12 + √35/28 + 13*√42/336 + √(2*√30 + 15)/8)/√(2*√30 + 15)
          (-√42/168 + √(-60*√30 + 450)/144 + √(-2*√30 + 15)/8 + √35/14)/√(-2*√30 + 15)
          (√30/144 + 1/8)
          (-13*√42/336 - √35/28 - √10/16 - √(60*√30 + 450)/144 + √3/12 + √(2*√30 + 15)/8)/√(2*√30 + 15)];
         [(-√(60*√30 + 450)/144 + √42/168 + √35/14 + √(2*√30 + 15)/8)/√(2*√30 + 15)
          (-13*√42/336 + √(-60*√30 + 450)/144 + √3/12 + √10/16 + √35/28 + √(-2*√30 + 15)/8)/√(-2*√30 + 15)
          (-√35/28 + √(-60*√30 + 450)/144 + √3/12 + √10/16 + 13*√42/336 + √(-2*√30 + 15)/8)/√(-2*√30 + 15)
          (-√30/144 + 1/8)]
        ]), (4,4))'

    b = Vector{T}([
          49/(216+12*√30),
          49/(216-12*√30),
          49/(216-12*√30),
          49/(216+12*√30)
        ])

    c = Vector{T}([
          1/2-√(3/7+2*√30/35)/2,
          1/2-√(3/7-2*√30/35)/2,
          1/2+√(3/7-2*√30/35)/2,
          1/2+√(3/7+2*√30/35)/2
        ])

    o = 8

    CoefficientsRK(:glrk4, o, a, b, c)
end

function getCoefficientsGLRK5(T=Float64)
    a = reshape(Array{T}([
         [-13*√70/3600 + 161/1800
          -59*√(20*√70 + 350)/19440 - 113*√(14*√70 + 245)/34020 - 11*√(-20*√70 + 350)/6480 + 4*√(-14*√70 + 245)/2835 + 13*√70/3600 + 161/1800
          -92*√(14*√70 + 245)/8505 + 4*√(20*√70 + 350)/1215 + 32/225
          -59*√(20*√70 + 350)/19440 - 113*√(14*√70 + 245)/34020 - 4*√(-14*√70 + 245)/2835 + 11*√(-20*√70 + 350)/6480 + 13*√70/3600 + 161/1800
          -2*√(14*√70 + 245)/315 - 13*√70/3600 + √(20*√70 + 350)/360 + 161/1800];
         [-113*√(-14*√70 + 245)/34020 - 13*√70/3600 + 4*√(14*√70 + 245)/2835 + 11*√(20*√70 + 350)/6480 + 59*√(-20*√70 + 350)/19440 + 161/1800
          13*√70/3600 + 161/1800
          -92*√(-14*√70 + 245)/8505 - 4*√(-20*√70 + 350)/1215 + 32/225
          -2*√(-14*√70 + 245)/315 - √(-20*√70 + 350)/360 + 13*√70/3600 + 161/1800
          -11*√(20*√70 + 350)/6480 - 113*√(-14*√70 + 245)/34020 - 13*√70/3600 - 4*√(14*√70 + 245)/2835 + 59*√(-20*√70 + 350)/19440 + 161/1800];
         [-23*√(20*√70 + 350)/5760 - 13*√70/3600 + 161/1800 + 11*√(14*√70 + 245)/1440
          13*√70/3600 + 23*√(-20*√70 + 350)/5760 + 11*√(-14*√70 + 245)/1440 + 161/1800
          32/225
          -11*√(-14*√70 + 245)/1440 - 23*√(-20*√70 + 350)/5760 + 13*√70/3600 + 161/1800
          -11*√(14*√70 + 245)/1440 - 13*√70/3600 + 161/1800 + 23*√(20*√70 + 350)/5760];
         [-59*√(-20*√70 + 350)/19440 - 13*√70/3600 + 4*√(14*√70 + 245)/2835 + 113*√(-14*√70 + 245)/34020 + 11*√(20*√70 + 350)/6480 + 161/1800
          13*√70/3600 + √(-20*√70 + 350)/360 + 2*√(-14*√70 + 245)/315 + 161/1800
          4*√(-20*√70 + 350)/1215 + 92*√(-14*√70 + 245)/8505 + 32/225
          13*√70/3600 + 161/1800
          -59*√(-20*√70 + 350)/19440 - 11*√(20*√70 + 350)/6480 - 13*√70/3600 - 4*√(14*√70 + 245)/2835 + 113*√(-14*√70 + 245)/34020 + 161/1800];
         [-√(20*√70 + 350)/360 - 13*√70/3600 + 161/1800 + 2*√(14*√70 + 245)/315
          -11*√(-20*√70 + 350)/6480 + 4*√(-14*√70 + 245)/2835 + 13*√70/3600 + 113*√(14*√70 + 245)/34020 + 59*√(20*√70 + 350)/19440 + 161/1800
          -4*√(20*√70 + 350)/1215 + 32/225 + 92*√(14*√70 + 245)/8505
          -4*√(-14*√70 + 245)/2835 + 11*√(-20*√70 + 350)/6480 + 13*√70/3600 + 113*√(14*√70 + 245)/34020 + 59*√(20*√70 + 350)/19440 + 161/1800
          -13*√70/3600 + 161/1800]
        ]), (5,5))'

    b = Vector{T}([
          1/(4600/729+1300*√70/5103),
          1/(4600/729-1300*√70/5103),
          64/225,
          1/(4600/729-1300*√70/5103),
          1/(4600/729+1300*√70/5103)
        ])

    c = Vector{T}([
          1/2-√(5/9+2*√70/63)/2,
          1/2-√(5/9-2*√70/63)/2,
          1/2,
          1/2+√(5/9-2*√70/63)/2,
          1/2+√(5/9+2*√70/63)/2
        ])

    o = 10

    CoefficientsRK(:glrk5, o, a, b, c)
end

function getCoefficientsGLRK6()
    a = [[0.04283112309479259  -0.01476372599719741   0.009325050706477751  -0.005668858049483512   0.002854433315099335  -0.0008127801712647621]
         [0.09267349143037886   0.09019039326203465  -0.020300102293239590   0.010363156240246420  -0.004887192928037672   0.001355561055485062]
         [0.08224792261284387   0.19603216233324500   0.11697848364317280   -0.020482527745656100   0.007989991899662336  -0.002075625784866334]
         [0.08773787197445151   0.17239079462440700   0.25443949503200160    0.11697848364317280   -0.015651375809175700   0.003414323576741299]
         [0.08430668513410011   0.18526797945210700   0.22359381104609910    0.25425706957958510    0.090190393262034650  -0.007011245240793691]
         [0.08647502636084993   0.17752635320897000   0.23962582533582900    0.22463191657986780    0.19514451252126670    0.04283112309479259]]
    b =  [0.08566224618958517,  0.18038078652406930,  0.23395696728634550,   0.23395696728634550,   0.18038078652406930,   0.08566224618958517]
    c =  [0.03376524289842399,  0.16939530676686770,  0.38069040695840150,   0.61930959304159850,   0.83060469323313230,   0.96623475710157600]
    o = 12

    CoefficientsRK(:glrk6, o, a, b, c)
end


function getCoefficientsGLRK(s::Int; T=Float64, high_precision=true)

    if high_precision == true
        if s == 1
            return getCoefficientsGLRK1(T)
        elseif s == 2
            return getCoefficientsGLRK2(T)
        elseif s == 3
            return getCoefficientsGLRK3(T)
        elseif s == 4
            return getCoefficientsGLRK4(T)
        elseif s == 5
            return getCoefficientsGLRK5(T)
        end
    end


    # order
    o = 2s

    # obtain Gauss-Legendre nodes and weights
    q = GaussLegendreQuadrature(s, T)

    # create Lagrange polynomial
    vdm = vandermonde_matrix_inverse(nodes(q))

    # compute monomial basis functions and corresponding integrals
    poly_ints = []
    for i in 1:s
        y = zeros(s)
        y[i] = 1
        mon = *(vdm, y)
        push!(poly_ints, polyint(Poly(mon)))
    end

    # compute Runge-Kutta coefficients
    a = zeros(s,s)
    for i in 1:s
        for j in 1:s
            a[i,j] = poly_ints[j](nodes(q)[i])
        end
    end

    CoefficientsRK(Symbol("glrk", s), o, a, weights(q), nodes(q))
end
